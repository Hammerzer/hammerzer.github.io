<!DOCTYPE html><html lang="zh-CN"><head><script src="https://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/180-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/32-32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/16-16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"hammerzer.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!1,nav:null,activeClass:"valine"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="CONTENT OUTLINE  Qt开发中的碎碎念  〇 目录"><meta property="og:type" content="article"><meta property="og:title" content="Qt项目-Weather"><meta property="og:url" content="https://hammerzer.github.io/2024/08/07/qt-project-weather/index.html"><meta property="og:site_name" content="Moustache&#39;s Blog"><meta property="og:description" content="CONTENT OUTLINE  Qt开发中的碎碎念  〇 目录"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hammerzer.github.io/.io//1-1.png"><meta property="og:image" content="https://hammerzer.github.io/.io//1-2.png"><meta property="article:published_time" content="2024-08-07T08:50:38.000Z"><meta property="article:modified_time" content="2025-01-19T03:19:15.890Z"><meta property="article:author" content="Moustache"><meta property="article:tag" content="操作系统与框架"><meta property="article:tag" content="Qt"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hammerzer.github.io/.io//1-1.png"><link rel="canonical" href="https://hammerzer.github.io/2024/08/07/qt-project-weather/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Qt项目-Weather | Moustache's Blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Moustache's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Moustache's Blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">小胡子的私人空间</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">34</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">78</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hammerzer.github.io/2024/08/07/qt-project-weather/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/180-180.png"><meta itemprop="name" content="Moustache"><meta itemprop="description" content="我是小胡子"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Moustache's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Qt项目-Weather</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-08-07 16:50:38" itemprop="dateCreated datePublished" datetime="2024-08-07T16:50:38+08:00">2024-08-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-01-19 11:19:15" itemprop="dateModified" datetime="2025-01-19T11:19:15+08:00">2025-01-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CPP/" itemprop="url" rel="index"><span itemprop="name">CPP</span></a> </span></span><span id="/2024/08/07/qt-project-weather/" class="post-meta-item leancloud_visitors" data-flag-title="Qt项目-Weather" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> <span>℃</span> </span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2024/08/07/qt-project-weather/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2024/08/07/qt-project-weather/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>17k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>15 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="CONTENT-OUTLINE"><a href="#CONTENT-OUTLINE" class="headerlink" title="CONTENT OUTLINE"></a>CONTENT OUTLINE</h2><blockquote><p><span style="background:#ff0">Qt开发中的碎碎念</span></p></blockquote><h2 id="〇-目录"><a href="#〇-目录" class="headerlink" title="〇 目录"></a>〇 目录</h2><span id="more"></span><br><h2 id="一-Weather项目"><a href="#一-Weather项目" class="headerlink" title="一 Weather项目"></a>一 Weather项目</h2><h3 id="1-1-项目设计"><a href="#1-1-项目设计" class="headerlink" title="1.1 项目设计"></a>1.1 项目设计</h3><p>天气预报是我们经常使用的一个工具，一般我们在手机上、电脑上，都有独立的应用，来提供查询天气预报。</p><p>此处，我们使用 <code>Qt</code> 来开发一款天气预报的应用。</p><p><img src="/.io//1-1.png"></p><p><strong>功能包括：</strong></p><ol><li>有城市的天气预报，有背景图、控件半透明化。</li><li>显示日期，城市名称，当天的天气预报</li><li>当天天气预报的详细数据</li><li>该天的一些生活指数：如感冒指数、每日寄语</li><li>当天的日出日落时间，及扇形时间占比</li><li>该城市，前一后四天的天气预报，含有日期，星期，天气，高低温</li><li>最近一周的温湿度曲线</li><li>搜索框、刷新按钮</li><li>窗口大小固定，无最大、最小化、关闭按钮。鼠标拖动窗口移动，右键退出。</li><li>自定义按钮图标</li></ol><p><strong>实现思路：</strong></p><ol><li>UI<ul><li>绘制基本界面，设计界面网状表格</li><li>添加控件、添加资源图片</li></ul></li><li>网络<ul><li>请求数据</li><li>解析数据</li></ul></li><li>UI<ul><li>根据数据更新控件上的数据和资源图标</li><li>根据数据绘制图案</li></ul></li></ol><br><blockquote><p>以下每个步骤均只简要记录。</p></blockquote><h3 id="1-2-创建项目"><a href="#1-2-创建项目" class="headerlink" title="1.2 创建项目"></a>1.2 创建项目</h3><ul><li><p>使用<code>QWidget</code>创建项目【不需要QMainWindow的状态栏和菜单栏】</p></li><li><p>添加<code>qrc</code>资源文件时，此项目是在三个图像文件夹中分别创建三个qrc文件，即在创建对话框中填写的路径为<code>/icons/icons</code>【以icons文件夹为例】</p></li><li><p>UI编辑器设置画布大小为<code>800*450</code>，然后从左侧选择Containers中Widget，直接从工具栏中拖到窗口，设置高宽将父组件他铺满【也可以在属性里设置坐标 (0, 0)，高宽<code>800*450</code>】，最后设置styleSheet属性：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">QWidget<span class="selector-id">#widget</span>&#123;</span><br><span class="line">    <span class="attribute">border-image</span>: <span class="built_in">url</span>(<span class="string">:/weaUI/weaUI.png</span>);</span><br><span class="line">    <span class="attribute">color</span>:<span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br><span class="line">QLabel&#123;</span><br><span class="line">    <span class="attribute">font</span>: <span class="number">25</span> <span class="number">10pt</span> <span class="string">&quot;Microsoft YaHei&quot;</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">argb</span>(<span class="number">60</span>, <span class="number">60</span>, <span class="number">60</span>, <span class="number">130</span>);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">Line</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">85</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*将 widget 的 border-image（背景图片）设置成 weaUI.png</span></span><br><span class="line"><span class="comment"> *字体颜色设置：255, 255, 255（白色）</span></span><br><span class="line"><span class="comment"> *QLabel控件设置字体。border-radius（圆角边半径）4 个像素。</span></span><br><span class="line"><span class="comment"> *background-color（背景颜色）：argb(60, 60, 60, 130);【对于rgb值和透明度】</span></span><br><span class="line"><span class="comment"> *Line线条控件的 background-color: rgb(0, 85, 0);背景颜色 */</span></span><br></pre></td></tr></table></figure></li><li><p>设置无边框窗口和不可缩放</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//设置窗口属性为无边框窗口</span></span><br><span class="line"><span class="built_in">setWindowFlag</span>(Qt::FramelessWindowHint);</span><br><span class="line"><span class="comment">//设置不可在右下角缩放</span></span><br><span class="line"><span class="built_in">setFixedSize</span>(<span class="built_in">width</span>(), <span class="built_in">height</span>());</span><br></pre></td></tr></table></figure></li><li><p>如果需要编辑ui的XML文件，需要使用外部软件【如Notepad++】打开修改。此处修改QMainWindow为QWidget。</p></li></ul><br><h3 id="1-3-鼠标拖动窗体和右键退出"><a href="#1-3-鼠标拖动窗体和右键退出" class="headerlink" title="1.3 鼠标拖动窗体和右键退出"></a>1.3 鼠标拖动窗体和右键退出</h3><p><strong>右键退出</strong></p><ul><li>在头文件的类的私有成员变量声明中加入QMenu指针【退出菜单】、QAction行为【exit行为，即右键菜单中的选项】</li><li>在QWidget类的实现中，将两个私有指针指向新创建的QMenu和QAction，并设置文本、Icon，将QAction加入QMenu并使用connect注册信号和槽关系。</li><li>需要实现contextMenuEvent函数【鼠标右击菜单事件】和槽函数<code>slot_exitApp()</code></li></ul><p><strong>鼠标拖动</strong></p><ul><li>新增一个QPoint私有成员记录差值</li><li>新增两个事件【mousePressEvent | mouseMoveEvent】函数并实现</li><li>鼠标拖动的实现思路：保持鼠标点击拖动时位置与应用窗口的相对位置保持不变【约束条件】<ul><li>鼠标按下时，记录差值，即鼠标点击的屏幕坐标 - 窗口的屏幕坐标。【其实记录鼠标在窗口内的坐标】</li><li>鼠标移动时同步修改窗口坐标为【鼠标的屏幕坐标 - 差值】</li></ul></li></ul><br><h3 id="1-4-绘制基础界面"><a href="#1-4-绘制基础界面" class="headerlink" title="1.4 绘制基础界面"></a>1.4 绘制基础界面</h3><p>基础控件</p><ul><li>新增一个<code>Line Edit</code>【只显示一行的文本框，用于显示和输出城市】，并设置位置和大小属性。</li><li>新增一个<code>Label</code>【用于显示日期】，并设置属性：位置、大小、本文字体及字号、对齐方式、StyleSheet等。</li><li>新增三个水平Line【属于Display Widget，用于分配区域】，分别修改位置参数。</li></ul><p>网格布局</p><ul><li>在第二线与第三线之间添加Grid Layout，再向其中加入4行3列的Label控件【默认等高等宽分割，想要得到不等分割的单元格，需要添加后点击并Delete删除，再将旁侧单元格拉长占用】，这样就可以等到等高且1:3宽度的表格布局。</li><li>修改Label属性：对象名、对齐方式、【可选择多个同时修改】</li><li>值得注意的一点是：形成三行合并的部分【在两大竖行合并时，如果删除其中一个，则网格会塌陷为两行；此时只需要将其中列数较小的一个Label拖至其他网格即可】</li></ul><br><h3 id="1-5-添加UI控件"><a href="#1-5-添加UI控件" class="headerlink" title="1.5 添加UI控件"></a>1.5 添加UI控件</h3><p>UI控件命名、默认内容、样式的填写</p><h3 id="1-6-控件添加图标资源"><a href="#1-6-控件添加图标资源" class="headerlink" title="1.6 控件添加图标资源"></a>1.6 控件添加图标资源</h3><blockquote><p>剩余左上角、左下角部分布局</p></blockquote><ul><li>实现竖排文本：打开文本编辑框，回车换行的方式会产生较大行距，可Shift+换行。</li><li>左下角新增文本工具【text browser】</li><li>右上角搜索框内添加按钮【tool Button，用于搜索确认】，设置位置属性、图标【使用styleSheet中的border-image】。</li><li>右上角搜索框右侧添加按钮【tool Button，用于刷新】，设置位置属性、图标【使用styleSheet中的border-image】、背景色。</li><li>修改右上角输入框的悬浮鼠标样式【】</li></ul><br><h3 id="1-7-QJson"><a href="#1-7-QJson" class="headerlink" title="1.7 QJson"></a>1.7 QJson</h3><p><code>QJson</code> 是 <code>Json</code> 的一种扩展，也就是一种简单的数据结构。</p><p>在本天气预报应用中，数据时刻都在更新。因此，我们需要向网络公共API请求数据，并接收 Json 格式的返回。</p><blockquote><p>那么什么是 Json？ JSON【JavaScript Object Notation】 是一种轻量级的数据交换格式。它使得人们很容易的进行 阅读和编写。同时也方便了机器进行解析和生成。它是基于 JavaScript Programming Language , Standard ECMA-262 3rd Edition - December 1999 的一个子集。</p><p>JSON 采用完 全独立于程序语言的文本格式，但是也使用了类 C 语言的习惯（包括 C, C++, C#, Java, JavaScript, Perl, Python 等）。这些特性使 JSON 成为理想的数据交换语言。</p></blockquote><p><code>Json</code> 基于两种结构：</p><ol><li>名称：值</li><li>值的有序列表</li></ol><p>而 <code>QJson</code> 也就是 Qt 版的 <code>Json</code>，具体内容查阅文档【QJsonDocument】</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonDocument&gt;</span>    <span class="comment">//读取和写入 Json 类</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonValue&gt;</span>        <span class="comment">//值</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonObject&gt;</span>        <span class="comment">//JSON对象是键值对的列表，其中键是唯一的字符串，值由QJsonValue表示</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonArray&gt;</span>        <span class="comment">//值列表，可以通过从数组中插入和删除 QJsonValue 来操作列表</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonParseError&gt;</span>    <span class="comment">//用于报告 JSON 解析过程中的错误</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//QJsonValue：QJson 的值有下列几种形式：</span></span><br><span class="line"><span class="comment">//enum QJsonValue::Type</span></span><br><span class="line">QJsonValue::Null         <span class="number">0x0A</span> 	Null value</span><br><span class="line">QJsonValue::Bool        <span class="number">0x1A</span> 	boolean value. <span class="function">Use <span class="title">toBool</span><span class="params">()</span> to convert to a <span class="type">bool</span>.</span></span><br><span class="line"><span class="function">QJsonValue::Double        0x2A 	number value. Use <span class="title">toDouble</span><span class="params">()</span> to convert to a <span class="type">double</span>, <span class="keyword">or</span> <span class="title">toInteger</span><span class="params">()</span> to convert to a qint64.</span></span><br><span class="line"><span class="function">QJsonValue::String        0x3A 	string. Use <span class="title">toString</span><span class="params">()</span> to convert to a QString.</span></span><br><span class="line"><span class="function">QJsonValue::Array        0x4An 	array. Use <span class="title">toArray</span><span class="params">()</span> to convert to a QJsonArray.</span></span><br><span class="line"><span class="function">QJsonValue::Object        0x5An 	object. Use <span class="title">toObject</span><span class="params">()</span> to convert to a QJsonObject.</span></span><br><span class="line"><span class="function">QJsonValue::Undefined    0x80The value is undefined. This is usually returned as an error condition, when trying to read an out of bounds value in an array <span class="keyword">or</span> a non existent key in an object</span></span><br><span class="line"><span class="function"><span class="comment">//注意：Array内的数据类型不一定相同，但代码规范要求数据类型一致</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="comment">//测试：www.json.cn</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;天气预报&quot;</span>,<span class="string">&quot;key&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;array&quot;</span>:[<span class="literal">false</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3.3</span>]&#125;</span><br><span class="line"><span class="comment">//对应的json解析：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;天气预报&quot;</span>,</span><br><span class="line">    <span class="string">&quot;key&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;array&quot;</span>: [</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        <span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">3.3</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="1-8-查询天气预报的开放API"><a href="#1-8-查询天气预报的开放API" class="headerlink" title="1.8 查询天气预报的开放API"></a>1.8 查询天气预报的开放API</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://t.weather.itboy.net/api/weather/city/101010100/</span><br></pre></td></tr></table></figure><blockquote><p>101010100为对应城市的编码</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;success感谢又拍云(upyun.com)提供CDN赞助&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20240814&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-08-14 14:04:04&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cityInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京市&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;citykey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;101010100&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;parent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12:04&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;shidu&quot;</span><span class="punctuation">:</span> <span class="string">&quot;57%&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pm25&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pm10&quot;</span><span class="punctuation">:</span> <span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;quality&quot;</span><span class="punctuation">:</span> <span class="string">&quot;优&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;wendu&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32.9&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ganmao&quot;</span><span class="punctuation">:</span> <span class="string">&quot;各类人群可自由活动&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;forecast&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;14&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 31℃&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 22℃&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ymd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-08-14&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;week&quot;</span><span class="punctuation">:</span> <span class="string">&quot;星期三&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sunrise&quot;</span><span class="punctuation">:</span> <span class="string">&quot;05:25&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sunset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;19:12&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;aqi&quot;</span><span class="punctuation">:</span> <span class="number">41</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东风&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2级&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;晴&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;notice&quot;</span><span class="punctuation">:</span> <span class="string">&quot;愿你拥有比阳光明媚的心情&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">/*date:15~28...........*/</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;yesterday&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 28℃&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 23℃&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ymd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-08-13&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;week&quot;</span><span class="punctuation">:</span> <span class="string">&quot;星期二&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sunrise&quot;</span><span class="punctuation">:</span> <span class="string">&quot;05:24&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sunset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;19:13&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;aqi&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东北风&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2级&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;阴&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;notice&quot;</span><span class="punctuation">:</span> <span class="string">&quot;不要被阴云遮挡住好心情&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br><h3 id="1-9-读取本地Json的城市列表并解析"><a href="#1-9-读取本地Json的城市列表并解析" class="headerlink" title="1.9 读取本地Json的城市列表并解析"></a>1.9 读取本地Json的城市列表并解析</h3><ul><li><p>新增头文件<code>WeatherTool.h</code>【解析本地资源文件】，并在其中初始化读取本地Json资源，读取流程如图所示：</p><p><img src="/.io//1-2.png"></p></li><li><p>新增两个类【当天天气类Today、天气预报数据类Forecast】，都放在头文件<code>weatherdata.h</code>中直接定义。</p></li><li><p>新增<code>weatherdata.cpp</code> 文件对类中变量做初始，以及<code>=</code>号操作的实现。需要注意字符串数值的转换，如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm25 = QString::<span class="built_in">number</span>( dataObj.<span class="built_in">value</span>(<span class="string">&quot;pm25&quot;</span>).<span class="built_in">toDouble</span>() );</span><br></pre></td></tr></table></figure></li></ul><br><h3 id="1-10-Ui及数据的初始化操作"><a href="#1-10-Ui及数据的初始化操作" class="headerlink" title="1.10 Ui及数据的初始化操作"></a>1.10 Ui及数据的初始化操作</h3><ul><li>在widget.h中新增私有变量，用于管理ui数据【7个<code>QList</code>】</li><li><code>&lt;&lt;</code>是 Qt 中QList的重载操作符，用于向列表中追加数据。</li><li>遍历 forecast_week_list 和 forecast_date_list，添加样式和更改数据。</li><li>设置右上角搜索框的样式：圆角、透明度。</li></ul><blockquote><p>注意：脚本只识别rgba或rgb，而不是argb。</p></blockquote><br><h3 id="1-11-请求天气-API-数据"><a href="#1-11-请求天气-API-数据" class="headerlink" title="1.11 请求天气 API 数据"></a>1.11 请求天气 API 数据</h3><p>使用Qt中的 <code>QNetworkAccessManager</code> 类，调用API网络接口，该类允许应用程序发送网络请求并接收响应。</p><ul><li>在使用之前需要头文件：<code>#include &lt;QNetworkAccessManager&gt;</code></li><li>而且在 <code>pro</code> 文件中，要添加：<code>QT += network</code> 才能正常使用：<code>QT += core gui network</code></li><li>对于 <code>http</code> 来说，最常见的就是<code>post</code> 和 <code>get</code>请求，该类中也封装了相应的函数。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Header:  #include &lt;QNetworkAccessManager&gt;</span></span><br><span class="line"><span class="comment">//qmake: QT += network</span></span><br><span class="line"><span class="comment">//Inherits: QObject</span></span><br><span class="line"><span class="function">QNetworkReply *<span class="title">get</span><span class="params">(<span class="type">const</span> QNetworkRequest &amp;request)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//【QNetworkReply】 请求后的数据和报头</span></span><br><span class="line"><span class="comment">//Header:  #include &lt;QNetworkReply&gt;</span></span><br><span class="line"><span class="comment">//qmake: QT += network</span></span><br><span class="line"><span class="comment">//Inherits: QIODevice</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//【QNetworkRequest】保存要用 QNetworkAccessManager 发送的请求</span></span><br><span class="line"><span class="built_in">QNetworkRequest</span>();</span><br><span class="line"><span class="built_in">QNetworkRequest</span>(<span class="type">const</span> QUrl &amp;url);<span class="comment">//使用QUrl直接构造</span></span><br><span class="line"><span class="built_in">QNetworkRequest</span>(<span class="type">const</span> QNetworkRequest &amp;other);</span><br><span class="line"></span><br><span class="line"><span class="comment">//QUrl构造</span></span><br><span class="line"><span class="built_in">QUrl</span>();</span><br><span class="line"><span class="built_in">QUrl</span>(<span class="type">const</span> QString &amp;url, QUrl::ParsingMode parsingMode = TolerantMode);<span class="comment">//使用字符串构造</span></span><br><span class="line"><span class="built_in">QUrl</span>(<span class="type">const</span> QUrl &amp;other);</span><br><span class="line"><span class="built_in">QUrl</span>(QUrl &amp;&amp;other);</span><br></pre></td></tr></table></figure><p>在 <code>widget.h</code> 头文件中新增私有成员变量：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Network</span></span><br><span class="line">QString url;        <span class="comment">//接口的链接</span></span><br><span class="line">QString city;       <span class="comment">//访问的城市</span></span><br><span class="line">QString cityTmp;    <span class="comment">//临时城市</span></span><br><span class="line">WeatherTool tool;   <span class="comment">//天气工具对象</span></span><br><span class="line">QNetworkAccessManager* manager;</span><br></pre></td></tr></table></figure><p>在其实现的构造函数中初始化并注册信号和槽函数的对应关系：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//网络请求初始化</span></span><br><span class="line"><span class="comment">// 请求天气 API 信息</span></span><br><span class="line">url = <span class="string">&quot;http://t.weather.itboy.net/api/weather/city/&quot;</span>;</span><br><span class="line">city = <span class="string">&quot;长沙&quot;</span>;</span><br><span class="line">cityTmp = city;</span><br><span class="line">manager = <span class="keyword">new</span> <span class="built_in">QNetworkAccessManager</span>(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//finished(QNetworkReply*)信号是QNetworkAccessManager自带的</span></span><br><span class="line"><span class="built_in">connect</span>(manager, <span class="built_in">SIGNAL</span>(<span class="built_in">finished</span>(QNetworkReply*)), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">replayFinished</span>(QNetworkReply*)));</span><br><span class="line"><span class="built_in">getWeatherInfo</span>(manager);</span><br></pre></td></tr></table></figure><p>注意：</p><ul><li>槽函数 <code>replayFinished(QNetworkReply*)</code> 需要加入到 <code>widget.h</code> 声明中，并在 <code>widget.cpp</code> 中实现。</li><li><code>getWeatherInfo(manager)</code> 函数作为 <code>protected</code>函数在<code>widget.h</code>中声明，并在 <code>widget.cpp</code> 中实现。</li><li><code>parseJson(QByteArray&amp; bytes)</code> 函数作为 <code>protected</code>函数在<code>widget.h</code>中声明，并在 <code>widget.cpp</code> 中实现。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*槽函数：处理网络请求回调*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::replayFinished</span><span class="params">(QNetworkReply* reply)</span></span>&#123;</span><br><span class="line">    QVariant status_code = reply-&gt;<span class="built_in">attribute</span>(QNetworkRequest::HttpStatusCodeAttribute);</span><br><span class="line">    <span class="keyword">if</span>(reply -&gt; <span class="built_in">error</span>() != QNetworkReply::NoError || status_code != <span class="number">200</span>)&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="string">u8&quot;错误&quot;</span>, <span class="string">u8&quot;天气：请求数据错误，检查网络连接！&quot;</span>, QMessageBox::Ok);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QByteArray bytes = reply-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; bytes;</span><br><span class="line">    <span class="built_in">parseJson</span>(bytes);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*请求数据*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::getWeatherInfo</span><span class="params">(QNetworkAccessManager* manager)</span></span>&#123;</span><br><span class="line">    QString citycode = tool[city];<span class="comment">//WeatherTool重载了[]运算符</span></span><br><span class="line">    <span class="keyword">if</span>(citycode==<span class="string">&quot;000000000&quot;</span>)&#123;</span><br><span class="line">        QMessageBox::<span class="built_in">warning</span>(<span class="keyword">this</span>, <span class="string">u8&quot;错误&quot;</span>, <span class="string">u8&quot;天气：指定城市不存在！&quot;</span>, QMessageBox::Ok);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QUrl <span class="title">jsonUrl</span><span class="params">(url + citycode)</span></span>;   <span class="comment">//创建一个QUrl类实例jsonUrl，并使用QString初始化</span></span><br><span class="line">    manager-&gt;<span class="built_in">get</span>( <span class="built_in">QNetworkRequest</span>(jsonUrl) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="1-12-解析天气信息"><a href="#1-12-解析天气信息" class="headerlink" title="1.12 解析天气信息"></a>1.12 解析天气信息</h3><ul><li>在 <code>widget.h</code> 头文件中新增私有成员变量：本地数据【<code>Today today; Forecast forecast[6];</code>】</li><li><code>parseJson(QByteArray&amp; bytes)</code> 解析函数见1.11节。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解析接口数据</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::parseJson</span><span class="params">(QByteArray&amp; bytes)</span></span>&#123;</span><br><span class="line">    QJsonParseError err;</span><br><span class="line">    QJsonDocument jsonDoc = QJsonDocument::<span class="built_in">fromJson</span>(bytes, &amp;err); <span class="comment">// 检测json格式</span></span><br><span class="line">    <span class="keyword">if</span> (err.error != QJsonParseError::NoError) <span class="comment">// Json 格式错误</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    QJsonObject jsObj = jsonDoc.<span class="built_in">object</span>();</span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; jsObj &lt;&lt; &quot;\n============\n&quot;;</span></span><br><span class="line">    <span class="comment">// qDebug() &lt;&lt; jsObj.value(&quot;message&quot;) &lt;&lt; &quot;\n============\n&quot;;</span></span><br><span class="line">    QString message = jsObj.<span class="built_in">value</span>(<span class="string">&quot;message&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">    <span class="keyword">if</span> (message.<span class="built_in">contains</span>(<span class="string">&quot;success&quot;</span>)==<span class="literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="built_in">tr</span>(<span class="string">&quot;The information of Json_desc&quot;</span>), <span class="string">u8&quot;天气：城市错误！&quot;</span>, QMessageBox::Ok );</span><br><span class="line">        city = cityTmp;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Today对象重载了=，即使用jsobj来初始化today</span></span><br><span class="line">    today = jsObj;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析 data 中的 yesterday</span></span><br><span class="line">    QJsonObject dataObj = jsObj.<span class="built_in">value</span>(<span class="string">&quot;data&quot;</span>).<span class="built_in">toObject</span>();</span><br><span class="line">    forecast[<span class="number">0</span>] = dataObj.<span class="built_in">value</span>(<span class="string">&quot;yesterday&quot;</span>).<span class="built_in">toObject</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析 data 中的 forecast</span></span><br><span class="line">    QJsonArray forecastArr = dataObj.<span class="built_in">value</span>(<span class="string">&quot;forecast&quot;</span>).<span class="built_in">toArray</span>();</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        forecast[i] = forecastArr.<span class="built_in">at</span>(j).<span class="built_in">toObject</span>();</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><h3 id="1-13-应用数据"><a href="#1-13-应用数据" class="headerlink" title="1.13 应用数据"></a>1.13 应用数据</h3><ul><li><code>void setLabelContent()</code> 函数作为 <code>protected</code>函数在<code>widget.h</code>中声明，并在 <code>widget.cpp</code> 中实现，用于将数据应用在ui组件上。</li><li>新增 <code>WeatherTypeIcoTool</code> 类【几乎类似 <code>WeatherTool</code> 类】，用于读取本地Json，建立天气类型字段与其对应图标的对应关系。</li></ul><br><h3 id="1-14-绘制日出日落曲线"><a href="#1-14-绘制日出日落曲线" class="headerlink" title="1.14 绘制日出日落曲线"></a>1.14 绘制日出日落曲线</h3><h4 id="1-14-1-QPainter-类"><a href="#1-14-1-QPainter-类" class="headerlink" title="1.14.1 QPainter 类"></a>1.14.1 <code>QPainter</code> 类</h4><p><code>QPainter</code> 类，用于低级【点、线、面】图像绘制。<code>QPainter</code> 类的成员有一下几种角色：</p><ul><li>QPen : 用于绘制几何图形的边缘，由颜色、宽度线风格等参数组成；</li><li>QBrush : 用于填充几何图形的调色板,由颜色和填充风格组成；</li><li>QFont : 用于文本绘制；</li><li>QPixmap : 绘制图片，可以加速显示，带有屏幕截图、窗口截图等支持，适合小图片；</li><li>QImage : 绘制图片，可以直接读取图像文件进行像素访问，适合大图片；</li><li>QBitmap : <code>QPixmap</code> 的一个子类，主要用于显示单色位图；</li><li>QPicture : 绘图装置，用于记录和重播 <code>Qpainter</code> 的绘图</li></ul><p><code>QPainter</code> 基础图形绘制相关函数：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Header:  #include &lt;QPainter&gt;</span></span><br><span class="line"><span class="comment">qmake: QT += gui</span></span><br><span class="line"><span class="comment">Inherited By: QStylePainter</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 注意：【其他重载见帮助文档】</span></span><br><span class="line"><span class="comment">// 绘制点</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawPoint</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span>;</span><br><span class="line"><span class="comment">// 绘制弦</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawChord</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> startAngle, <span class="type">int</span> spanAngle)</span></span>;</span><br><span class="line"><span class="comment">// 绘制直线</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawLine</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawLine</span><span class="params">(<span class="type">const</span> QPoint &amp;p1, <span class="type">const</span> QPoint &amp;p2)</span></span>;</span><br><span class="line"><span class="comment">// 绘制多边形</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawPolygon</span><span class="params">(<span class="type">const</span> QPointF *points, <span class="type">int</span> pointCount, Qt::FillRule fillRule = Qt::OddEvenFill)</span></span>;</span><br><span class="line"><span class="comment">// 绘制矩形</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawRect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height)</span></span>;</span><br><span class="line"><span class="comment">// 绘制圆角矩形</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawRoundedRect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> h, qreal xRadius, qreal yRadius, Qt::SizeMode mode = Qt::AbsoluteSize)</span></span>;</span><br><span class="line"><span class="comment">// 绘制圆弧</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawArc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> startAngle, <span class="type">int</span> spanAngle)</span></span>;</span><br><span class="line"><span class="comment">// 绘制折线</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawPolyline</span><span class="params">(<span class="type">const</span> QPointF *points, <span class="type">int</span> pointCount)</span></span>;</span><br><span class="line"><span class="comment">// 绘制椭圆</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawEllipse</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height)</span></span>;</span><br><span class="line"><span class="comment">// 绘制凹多边形</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawConvexPolygon</span><span class="params">(<span class="type">const</span> QPointF *points, <span class="type">int</span> pointCount)</span></span>;</span><br><span class="line"><span class="comment">// 绘制扇形</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawPie</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> startAngle, <span class="type">int</span> spanAngle)</span></span>;</span><br><span class="line"><span class="comment">// 绘制文本</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawText</span><span class="params">(<span class="type">const</span> QRect &amp;rectangle, <span class="type">int</span> flags, <span class="type">const</span> QString &amp;text, QRect *boundingRect = <span class="literal">nullptr</span>)</span></span>;</span><br></pre></td></tr></table></figure><h4 id="1-14-2-绘制日出日落曲线"><a href="#1-14-2-绘制日出日落曲线" class="headerlink" title="1.14.2 绘制日出日落曲线"></a>1.14.2 绘制日出日落曲线</h4><p>本应用中绘制日出日落曲线，使用Pen绘制直线、曲线、文字，使用刷子绘制扇形。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日出日落底线</span></span><br><span class="line"><span class="type">const</span> QPoint Widget::sun[<span class="number">2</span>] = &#123;</span><br><span class="line">    <span class="built_in">QPoint</span>(<span class="number">20</span>, <span class="number">75</span>),</span><br><span class="line">    <span class="built_in">QPoint</span>(<span class="number">130</span>, <span class="number">75</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 日出日落时间</span></span><br><span class="line"><span class="type">const</span> QRect Widget::sunRizeSet[<span class="number">2</span>] = &#123;</span><br><span class="line">    <span class="built_in">QRect</span>(<span class="number">0</span>, <span class="number">80</span>, <span class="number">50</span>, <span class="number">20</span>),</span><br><span class="line">    <span class="built_in">QRect</span>(<span class="number">100</span>, <span class="number">80</span>, <span class="number">50</span>, <span class="number">20</span>)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 日出日落圆弧</span></span><br><span class="line"><span class="type">const</span> QRect Widget::rect[<span class="number">2</span>] = &#123;</span><br><span class="line">    <span class="built_in">QRect</span>(<span class="number">25</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="comment">// 虚线圆弧</span></span><br><span class="line">    <span class="built_in">QRect</span>(<span class="number">50</span>, <span class="number">80</span>, <span class="number">50</span>, <span class="number">20</span>) <span class="comment">// “日出日落”文本</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::paintSunRiseSet</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//首先指明绘图位置：事先设计的Label位置</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(ui-&gt;sunRiseSetLb)</span></span>;</span><br><span class="line">    <span class="comment">//QPainter反锯齿设置:去除直线毛边</span></span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//save保存当前绘制器状态（将状态推送到堆栈上）</span></span><br><span class="line">    <span class="comment">//save后面必须跟有相应的restore【重置】、end【结束、释放资源】函数使用</span></span><br><span class="line">    <span class="comment">//end 通常不需要调用，一般由析构函数来调用</span></span><br><span class="line">    painter.<span class="built_in">save</span>();</span><br><span class="line">    QPen pen = painter.<span class="built_in">pen</span>();<span class="comment">//创建 QPen 对象，用于绘制几何图形的边缘，可理解为一支笔</span></span><br><span class="line">    pen.<span class="built_in">setWidthF</span>(<span class="number">0.5</span>);      <span class="comment">//设置笔的宽度</span></span><br><span class="line">    pen.<span class="built_in">setColor</span>(Qt::yellow);<span class="comment">//设置笔的颜色</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);     <span class="comment">//将笔添加到绘制器中</span></span><br><span class="line">    painter.<span class="built_in">drawLine</span>(sun[<span class="number">0</span>], sun[<span class="number">1</span>]);<span class="comment">//;绘制直线【日出日落底线】，参数为两端点</span></span><br><span class="line">    painter.<span class="built_in">restore</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制日出日落文字</span></span><br><span class="line">    painter.<span class="built_in">save</span>();</span><br><span class="line">    painter.<span class="built_in">setFont</span>( <span class="built_in">QFont</span>(<span class="string">&quot;Microsoft Yahei&quot;</span>, <span class="number">8</span>, QFont::Normal) ); <span class="comment">// 字体、大小、正常粗细</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::white);</span><br><span class="line">    <span class="keyword">if</span> (today.sunrise != <span class="string">&quot;&quot;</span> &amp;&amp; today.sunset != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="comment">//在指定区域内绘制文字</span></span><br><span class="line">        painter.<span class="built_in">drawText</span>(sunRizeSet[<span class="number">0</span>], Qt::AlignHCenter, today.sunrise);</span><br><span class="line">        painter.<span class="built_in">drawText</span>(sunRizeSet[<span class="number">1</span>], Qt::AlignHCenter, today.sunset);</span><br><span class="line">    &#125;</span><br><span class="line">    painter.<span class="built_in">drawText</span>(rect[<span class="number">1</span>], Qt::AlignHCenter, <span class="string">u8&quot;日出日落&quot;</span>);<span class="comment">//在指定区域绘制文字</span></span><br><span class="line">    painter.<span class="built_in">restore</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绘制圆弧</span></span><br><span class="line">    painter.<span class="built_in">save</span>();</span><br><span class="line">    pen.<span class="built_in">setWidthF</span>(<span class="number">0.5</span>);         <span class="comment">//设置线条的宽度 0.5</span></span><br><span class="line">    pen.<span class="built_in">setStyle</span>(Qt::DotLine);  <span class="comment">//虚线</span></span><br><span class="line">    pen.<span class="built_in">setColor</span>(Qt::green);    <span class="comment">//设置颜色</span></span><br><span class="line">    painter.<span class="built_in">setPen</span>(pen);</span><br><span class="line">    <span class="comment">//drawArc(绘制的区域，其实角度，终止角度)</span></span><br><span class="line">    <span class="comment">//Qt中角度的基数是16分之一度，所以在任何话圆弧的地方，都要乘以16</span></span><br><span class="line">    painter.<span class="built_in">drawArc</span>(rect[<span class="number">0</span>], <span class="number">0</span> * <span class="number">16</span>, <span class="number">180</span> * <span class="number">16</span>); <span class="comment">//绘制圆弧 0~180度</span></span><br><span class="line">    painter.<span class="built_in">restore</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绘制日出日落占比</span></span><br><span class="line">    <span class="keyword">if</span> (today.sunrise != <span class="string">&quot;&quot;</span> &amp;&amp; today.sunset != <span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        painter.<span class="built_in">setPen</span>(Qt::NoPen);<span class="comment">//关闭画笔</span></span><br><span class="line">        painter.<span class="built_in">setBrush</span>(<span class="built_in">QColor</span>(<span class="number">255</span>, <span class="number">85</span>, <span class="number">0</span>, <span class="number">100</span>));<span class="comment">//设置画刷</span></span><br><span class="line">        <span class="type">int</span> startAngle, spanAngle;</span><br><span class="line">        QString sunsetTime = today.date + <span class="string">&quot; &quot;</span> + today.sunset;</span><br><span class="line">        <span class="keyword">if</span> (QDateTime::<span class="built_in">currentDateTime</span>() &gt; QDateTime::<span class="built_in">fromString</span>(sunsetTime, <span class="string">&quot;yyyy-MM-dd hh:mm&quot;</span>))&#123;</span><br><span class="line">            startAngle = <span class="number">0</span> * <span class="number">16</span>;</span><br><span class="line">            spanAngle = <span class="number">180</span> * <span class="number">16</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 计算起始角度和跨越角度</span></span><br><span class="line">            <span class="type">static</span> QStringList sunSetTime = today.sunset.<span class="built_in">split</span>(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">            <span class="type">static</span> QStringList sunRiseTime = today.sunrise.<span class="built_in">split</span>(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">            <span class="type">static</span> QString sunsetHour = sunSetTime.<span class="built_in">at</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="type">static</span> QString sunsetMint = sunSetTime.<span class="built_in">at</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="type">static</span> QString sunriseHour = sunRiseTime.<span class="built_in">at</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="type">static</span> QString sunriseMint = sunRiseTime.<span class="built_in">at</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="type">static</span> <span class="type">int</span> sunrise = sunriseHour.<span class="built_in">toInt</span>() * <span class="number">60</span> + sunriseMint.<span class="built_in">toInt</span>();</span><br><span class="line">            <span class="type">static</span> <span class="type">int</span> sunset = sunsetHour.<span class="built_in">toInt</span>() * <span class="number">60</span> + sunsetMint.<span class="built_in">toInt</span>();</span><br><span class="line">            <span class="type">int</span> now = QTime::<span class="built_in">currentTime</span>().<span class="built_in">hour</span>() * <span class="number">60</span> + QTime::<span class="built_in">currentTime</span>().<span class="built_in">minute</span>();</span><br><span class="line">            startAngle = ( (<span class="type">double</span>)(sunset - now) / (sunset - sunrise) ) * <span class="number">180</span> * <span class="number">16</span>;</span><br><span class="line">            spanAngle = ( (<span class="type">double</span>)(now - sunrise) / (sunset - sunrise) ) * <span class="number">180</span> * <span class="number">16</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (startAngle &gt;= <span class="number">0</span> &amp;&amp; spanAngle &gt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            painter.<span class="built_in">drawPie</span>(rect[<span class="number">0</span>], startAngle, spanAngle); <span class="comment">// 扇形绘制</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// painter.end();//析构时自动end</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>值得注意的是：何时如何调用 <code>paintSunRiseSet</code> 函数？</p><ul><li><p>在 <code>Widget</code> 构造函数中，注册定时器和事件连接</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="comment">//安装绘图事件</span></span><br><span class="line">    ui-&gt;sunRiseSetLb-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);<span class="comment">//在eventFilter函数中处理</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//自动刷新日出日落曲线    </span></span><br><span class="line">    sunTimer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(ui-&gt;sunRiseSetLb);</span><br><span class="line">    sunTimer-&gt;<span class="built_in">start</span>(<span class="number">2000</span>);    <span class="comment">//2s触发一次</span></span><br><span class="line">    <span class="comment">// 当定时器时间到期，自动触发sunRiseSetLb的update()</span></span><br><span class="line">    <span class="built_in">connect</span>(sunTimer, <span class="built_in">SIGNAL</span>(<span class="built_in">timeout</span>()), ui-&gt;sunRiseSetLb, <span class="built_in">SLOT</span>(<span class="built_in">update</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>virtual bool eventFilter(QObject* watched, QEvent* event)</code> 函数作为 <code>public</code>函数在<code>widget.h</code>中声明，并在 <code>widget.cpp</code> 中实现，用于接收事件信号【如果是来自 <code>sunRiseSetLb</code> 的绘图事件信号，则处理，其余事件交予父类的默认处理】</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Widget::eventFilter</span><span class="params">(QObject* watched, QEvent* event)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(watched == ui-&gt;sunRiseSetLb &amp;&amp; event-&gt;<span class="built_in">type</span>() == QEvent::Paint)&#123;</span><br><span class="line">        <span class="built_in">paintSunRiseSet</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 否则为默认处理</span></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(watched, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><br><h3 id="1-15-绘制温湿度折线"><a href="#1-15-绘制温湿度折线" class="headerlink" title="1.15 绘制温湿度折线"></a>1.15 绘制温湿度折线</h3><ul><li><code>void paintCurve()</code> 函数作为 <code>protected</code>函数在<code>widget.h</code>中声明，并在 <code>widget.cpp</code> 中实现，用于绘制温湿度折线。</li><li>添加事件过滤，即时渲染。</li></ul><br><h3 id="1-16-收尾功能"><a href="#1-16-收尾功能" class="headerlink" title="1.16 收尾功能"></a>1.16 收尾功能</h3><p><strong>① 搜索</strong></p><p>在UI设计界面，右击刷新图标，选择转到槽，选择点击事件 <code>clicked()</code>。</p><p>自动添加 <code>on_refreshBt_clicked()</code> 槽函数，并编写细节：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_refreshBt_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">getWeatherInfo</span>(manager);</span><br><span class="line">    ui-&gt;curveLb-&gt;<span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::on_searchBt_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cityTmp = city;</span><br><span class="line">    city = ui-&gt;cityLineEdit-&gt;<span class="built_in">text</span>();</span><br><span class="line">    <span class="built_in">getWeatherInfo</span>(manager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><p><strong>② 刷新</strong></p><p>同上一小节的搜索，自动添加<code>on_searchBt_clicked ()</code>函数，并编写细节，详见上。</p><br><p><strong>③ 事件过滤</strong></p><p>为温湿度曲线、编辑框、日出日落曲线添加事件过滤器</p><ol><li><p>在 <code>Widget</code> 构造函数中安装事件过滤器</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装绘图事件</span></span><br><span class="line">   ui-&gt;sunRiseSetLb-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line">   ui-&gt;cityLineEdit-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line">   ui-&gt;curveLb-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></li><li><p>在自定义事件过滤器中对特定事件进行处理</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//widget.h中</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">Widget</span>();</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">eventFilter</span><span class="params">(QObject* watched, QEvent* event)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//widget.cpp中</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Widget::eventFilter</span><span class="params">(QObject* watched, QEvent* event)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(watched == ui-&gt;sunRiseSetLb &amp;&amp; event-&gt;<span class="built_in">type</span>() == QEvent::Paint)&#123;</span><br><span class="line">        <span class="built_in">paintSunRiseSet</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(watched == ui-&gt;curveLb &amp;&amp; event-&gt;<span class="built_in">type</span>() == QEvent::Paint)&#123;</span><br><span class="line">        <span class="built_in">paintCurve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 否则为默认处理</span></span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(watched, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><br><h2 id="二-Problems"><a href="#二-Problems" class="headerlink" title="二 Problems"></a>二 Problems</h2><h3 id="2-1-中文乱码问题"><a href="#2-1-中文乱码问题" class="headerlink" title="2.1 中文乱码问题"></a>2.1 中文乱码问题</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv30909641/%E3%80%90Qt%E7%A8%8B%E5%BA%8F%E4%B9%B1%E7%A0%81-%E4%BB%8E%E7%90%86%E8%A7%A3%E5%88%B0%E6%B6%88%E5%A4%B1%E3%80%91">https://www.bilibili.com/read/cv30909641/【Qt程序乱码-从理解到消失】</a></p><p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/275365.htm%E3%80%90QT6%E4%B8%ADQTextcodec%E5%A4%B4%E6%96%87%E4%BB%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E3%80%91">https://www.jb51.net/article/275365.htm【QT6中QTextcodec头文件找不到的解决方法】</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34342578/article/details/92364764?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=qt%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E8%B5%84%E6%BA%90&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-92364764.142%E3%80%90QT%E6%80%8E%E6%A0%B7%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E3%80%91">https://blog.csdn.net/weixin_34342578/article/details/92364764?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=qt%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E8%B5%84%E6%BA%90&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-92364764.142【QT怎样支持中文】</a></p><p>【未解决】资源【如图片】文件名字带中文，不能编译</p><blockquote><p>修改资源名称为英文字符，从而绕过该问题。</p></blockquote><p>注意：Qt 中使用中文的时候，在字符串的前面加 u8，若编译不还是报错，可以试着用 notpad++，或者 vscode 打开该文件，使用编码 utf-8 Bom 保存。再到项目里面来编译就不 会有报中文的错误了</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qt<span class="selector-class">.gui</span><span class="selector-class">.imageio</span>: libpng warning: iCCP: known incorrect sRGB profile</span><br></pre></td></tr></table></figure><p>在Qt开发过程中使用了一些png图片导致报了这个信息，是因为这些png图片中嵌入了icc颜色管理模块导致。</p><p>解决方法：</p><p>下载<a target="_blank" rel="noopener" href="https://github.com/188080501/JQTools/releases/tag/V20.6.9">JQTools</a>工具，然后点击“Qt相关”-&gt;“PNG告警消除”，选择图片进行转换便可以消除告警。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></div><div class="reward-container"><div></div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.png" alt="Moustache 微信支付"><p>微信支付</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Moustache</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://hammerzer.github.io/2024/08/07/qt-project-weather/" title="Qt项目-Weather">https://hammerzer.github.io/2024/08/07/qt-project-weather/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%A1%86%E6%9E%B6/" rel="tag"><i class="fa fa-tag"></i> 操作系统与框架</a> <a href="/tags/Qt/" rel="tag"><i class="fa fa-tag"></i> Qt</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2024/07/16/qt-Quick-Start/" rel="prev" title="Qt快速入门"><i class="fa fa-chevron-left"></i> Qt快速入门</a></div><div class="post-nav-item"><a href="/2024/08/20/CPP-QA/" rel="next" title="CPP-QA">CPP-QA <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#CONTENT-OUTLINE"><span class="nav-number">1.</span> <span class="nav-text">CONTENT OUTLINE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E3%80%87-%E7%9B%AE%E5%BD%95"><span class="nav-number">2.</span> <span class="nav-text">〇 目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-Weather%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.</span> <span class="nav-text">一 Weather项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.1.</span> <span class="nav-text">1.1 项目设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.2.</span> <span class="nav-text">1.2 创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E9%BC%A0%E6%A0%87%E6%8B%96%E5%8A%A8%E7%AA%97%E4%BD%93%E5%92%8C%E5%8F%B3%E9%94%AE%E9%80%80%E5%87%BA"><span class="nav-number">3.3.</span> <span class="nav-text">1.3 鼠标拖动窗体和右键退出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E7%BB%98%E5%88%B6%E5%9F%BA%E7%A1%80%E7%95%8C%E9%9D%A2"><span class="nav-number">3.4.</span> <span class="nav-text">1.4 绘制基础界面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E6%B7%BB%E5%8A%A0UI%E6%8E%A7%E4%BB%B6"><span class="nav-number">3.5.</span> <span class="nav-text">1.5 添加UI控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-%E6%8E%A7%E4%BB%B6%E6%B7%BB%E5%8A%A0%E5%9B%BE%E6%A0%87%E8%B5%84%E6%BA%90"><span class="nav-number">3.6.</span> <span class="nav-text">1.6 控件添加图标资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-7-QJson"><span class="nav-number">3.7.</span> <span class="nav-text">1.7 QJson</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-8-%E6%9F%A5%E8%AF%A2%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%9A%84%E5%BC%80%E6%94%BEAPI"><span class="nav-number">3.8.</span> <span class="nav-text">1.8 查询天气预报的开放API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-9-%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0Json%E7%9A%84%E5%9F%8E%E5%B8%82%E5%88%97%E8%A1%A8%E5%B9%B6%E8%A7%A3%E6%9E%90"><span class="nav-number">3.9.</span> <span class="nav-text">1.9 读取本地Json的城市列表并解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-10-Ui%E5%8F%8A%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="nav-number">3.10.</span> <span class="nav-text">1.10 Ui及数据的初始化操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-11-%E8%AF%B7%E6%B1%82%E5%A4%A9%E6%B0%94-API-%E6%95%B0%E6%8D%AE"><span class="nav-number">3.11.</span> <span class="nav-text">1.11 请求天气 API 数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-12-%E8%A7%A3%E6%9E%90%E5%A4%A9%E6%B0%94%E4%BF%A1%E6%81%AF"><span class="nav-number">3.12.</span> <span class="nav-text">1.12 解析天气信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-13-%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE"><span class="nav-number">3.13.</span> <span class="nav-text">1.13 应用数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-14-%E7%BB%98%E5%88%B6%E6%97%A5%E5%87%BA%E6%97%A5%E8%90%BD%E6%9B%B2%E7%BA%BF"><span class="nav-number">3.14.</span> <span class="nav-text">1.14 绘制日出日落曲线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-14-1-QPainter-%E7%B1%BB"><span class="nav-number">3.14.1.</span> <span class="nav-text">1.14.1 QPainter 类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-14-2-%E7%BB%98%E5%88%B6%E6%97%A5%E5%87%BA%E6%97%A5%E8%90%BD%E6%9B%B2%E7%BA%BF"><span class="nav-number">3.14.2.</span> <span class="nav-text">1.14.2 绘制日出日落曲线</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-15-%E7%BB%98%E5%88%B6%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%8A%98%E7%BA%BF"><span class="nav-number">3.15.</span> <span class="nav-text">1.15 绘制温湿度折线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-16-%E6%94%B6%E5%B0%BE%E5%8A%9F%E8%83%BD"><span class="nav-number">3.16.</span> <span class="nav-text">1.16 收尾功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-Problems"><span class="nav-number">4.</span> <span class="nav-text">二 Problems</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="nav-number">4.1.</span> <span class="nav-text">2.1 中文乱码问题</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Moustache" src="/images/180-180.png"><p class="site-author-name" itemprop="name">Moustache</p><div class="site-description" itemprop="description">我是小胡子</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">78</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/hammerzer" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hammerzer" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:stellar_lzu@163.com" title="E-Mail → mailto:stellar_lzu@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Chase</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">1.9m</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">29:01</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script size="300" alpha="0.4" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'JRehDoQ6pHXV1zKg09AMNLFt-gzGzoHsz',
      appKey     : 'cRAt4W15KiQdrIuHlQrRrtIl',
      placeholder: "Just go go",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>